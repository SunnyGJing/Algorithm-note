> Creat time: 2021-10-2晚上  

124.【Hard】买卖的最佳时期_IV
### 题目描述  
给定一个数组，记录了第i天的股票价格，请计算出买卖的最大收益。  
PS: 可以`k`次买卖，不能时间重叠

- Example 1:
    ```
    输入：k = 2, prices = [2,4,1]
    输出：2
    解释：在第 1 天 (股票价格 = 2) 的时候买入，在第 2 天 (股票价格 = 4) 的时候卖出，这笔交易所能获得利润 = 4-2 = 2 。
    ```
- Example 2:
    ```
    输入：k = 2, prices = [3,2,6,5,0,3]
    输出：7
    解释：在第 2 天 (股票价格 = 2) 的时候买入，在第 3 天 (股票价格 = 6) 的时候卖出, 这笔交易所能获得利润 = 6-2 = 4 。
    随后，在第 5 天 (股票价格 = 0) 的时候买入，在第 6 天 (股票价格 = 3) 的时候卖出, 这笔交易所能获得利润 = 3-0 = 3 。
    ```

### 题解
本题是 `Leetcode 123.买卖股票的最佳时机III` 的升级题型，所以题解完全相同，**动态规划**，唯一的不同之处：`2` 次交易只需要 `2` 对变量存储最大收益，而 `k` 次交易则需要 `k` 对变量存储最大收益（用长度为k的数组）  

初始状态：
- `k` 次买入的最大收益都是 `-price[0]`，而 `k` 次卖出的最大收益都是 `0`

状态转移：
- 可以联想**背包问题，第二个for循环是逆向的**！因为做了空间优化，把三维数组优化为二维数组，原三维数组的第一个维度是`第i个股票价格`

- 以第 `i` 个股票价格为例，它作为第 `k` 次买入的最大收益是 `前i-1个股票价格分别作为第k次买入时的最大收益` 和 `前i-1个股票价格分别作为第k-1次卖出时的最大收益减去第i个股票的价格`，而它作为第 `k` 次卖出的最大收益是 `前i-1个股票价格分别作为第k次卖出时的最大收益` 和 `前i-1个股票价格分别作为第k次卖出时的最大收益加上第i个股票的价格`


```python
class Solution:
    def maxProfit(self, k: int, prices: List[int]) -> int:
        if not k or not prices: return 0
        dp = [[-prices[0], 0] for i in range(k + 1)]
        for i in range(1, len(prices)):
            for j in range(k-1, -1, -1): # 以防覆盖，反向迭代
                # 第j次买入
                dp[j][0] = max(dp[j][0], dp[j-1][1] - prices[i])
                # 第j次卖出
                dp[j][1] = max(dp[j][1], dp[j][0] + prices[i])
        return dp[k-1][1]
```